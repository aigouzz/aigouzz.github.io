<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>算法-leetcode | 算法-leetcode</title>
    <meta name="description" content="algorithm leetcode vue3 vitepress vite vue-router vuex">
    <link rel="stylesheet" href="/algorithm/assets/style.80763ea9.css">
    <link rel="modulepreload" href="/algorithm/assets/app.b5287e93.js">
    <link rel="modulepreload" href="/algorithm/assets/comp_1.md.87a73c59.lean.js">
    
    <link rel="icon" href="https://aigouzz.github.io/dist/logo.png">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-0dd73670><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b45a8805></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-b45a8805> Skip to content </a><!--]--><!----><header class="VPNav" data-v-0dd73670 data-v-b71ddd30><div class="VPNavBar has-sidebar" data-v-b71ddd30 data-v-eccc28dd><div class="container" data-v-eccc28dd><div class="VPNavBarTitle has-sidebar" data-v-eccc28dd data-v-4208b882><a class="title" href="/algorithm/" data-v-4208b882><!--[--><!--]--><!--[--><img class="VPImage logo" src="/algorithm/logo.png" alt data-v-f50c4392><!--]--><!--[-->算法-algorithm-leetcode<!--]--><!--[--><!--]--></a></div><div class="content" data-v-eccc28dd><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-eccc28dd data-v-696ccc98><span id="main-nav-aria-label" class="visually-hidden" data-v-696ccc98>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://aigouzz.github.io/dist" target="_blank" rel="noreferrer" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->前端架构<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-696ccc98 data-v-a6dd6545><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a6dd6545><span class="text" data-v-a6dd6545><!----> 源码解析 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-a6dd6545><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-a6dd6545><div class="VPMenu" data-v-a6dd6545 data-v-857bd1d4><div class="items" data-v-857bd1d4><!--[--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/vue2" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->Vue2<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/vue3" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->Vue3<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/react" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->React<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/redux" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->Redux<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/webpack" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->Webpack<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="https://aigouzz.github.io/algorithm" target="_blank" rel="noreferrer" data-v-4989b3bb data-v-67783dc9><!--[-->Algorithm<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-67783dc9><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://aigouzz.github.io/shop" target="_blank" rel="noreferrer" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->商铺项目<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://aigouzz.github.io/music" target="_blank" rel="noreferrer" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->听音乐<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://aigouzz.github.io/demos" target="_blank" rel="noreferrer" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->组件<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-eccc28dd data-v-dd448478><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-dd448478 data-v-abbbf13a data-v-8b63d125><span class="check" data-v-8b63d125><span class="icon" data-v-8b63d125><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-abbbf13a><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-abbbf13a><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-eccc28dd data-v-58029811 data-v-a6dd6545><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-a6dd6545><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-a6dd6545><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-a6dd6545><div class="VPMenu" data-v-a6dd6545 data-v-857bd1d4><!----><!--[--><!--[--><!----><div class="group" data-v-58029811><div class="item appearance" data-v-58029811><p class="label" data-v-58029811>Appearance</p><div class="appearance-action" data-v-58029811><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-58029811 data-v-abbbf13a data-v-8b63d125><span class="check" data-v-8b63d125><span class="icon" data-v-8b63d125><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-abbbf13a><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-abbbf13a><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-eccc28dd data-v-3ea288f5><span class="container" data-v-3ea288f5><span class="top" data-v-3ea288f5></span><span class="middle" data-v-3ea288f5></span><span class="bottom" data-v-3ea288f5></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-0dd73670 data-v-6b8a8242><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-6b8a8242><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-6b8a8242><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-6b8a8242>Menu</span></button><a class="top-link" href="#" data-v-6b8a8242> Return to top </a></div><aside class="VPSidebar" data-v-0dd73670 data-v-8311cc44><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-8311cc44><span class="visually-hidden" id="sidebar-aria-label" data-v-8311cc44> Sidebar Navigation </span><!--[--><div class="group" data-v-8311cc44><section class="VPSidebarGroup collapsible" data-v-8311cc44 data-v-69237d58><div class="title" role="button" data-v-69237d58><h2 class="title-text" data-v-69237d58>前言</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link" href="/algorithm/intro/1.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>数据结构</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/intro/2.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>算法知识</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/intro/3.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>时间复杂度</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-8311cc44><section class="VPSidebarGroup collapsible" data-v-8311cc44 data-v-69237d58><div class="title" role="button" data-v-69237d58><h2 class="title-text" data-v-69237d58>算法专题</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link" href="/algorithm/data/1.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>array</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/2.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>string</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/3.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>two pointers</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/4.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>linked list</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/5.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>stack</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/6.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>tree</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/7.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>dynamic programming</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/8.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>backtracking</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/9.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>depth first search</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/10.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>breadth first search</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/11.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>binary search</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/12.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>math</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/13.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>hash table</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/14.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>sorting</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/15.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>bit manipulation</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/16.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>union find</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/17.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>sliding window</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/18.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>segment tree</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/data/19.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>binary indexed tree</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-8311cc44><section class="VPSidebarGroup collapsible" data-v-8311cc44 data-v-69237d58><div class="title" role="button" data-v-69237d58><h2 class="title-text" data-v-69237d58>模版</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link active" href="/algorithm/comp/1.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>segment tree</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/comp/2.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>unionfind</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/comp/3.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>LRUCache</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/comp/4.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>LFUCache</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/comp/5.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>Binary Indexed Tree</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-8311cc44><section class="VPSidebarGroup collapsible" data-v-8311cc44 data-v-69237d58><div class="title" role="button" data-v-69237d58><h2 class="title-text" data-v-69237d58>leetcode题解</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link" href="/algorithm/proxy/1.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>two sum</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/2.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>add two numbers</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/3.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>longest substring without repeating characters</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/4.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>median of two sorted arrays</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/5.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>longest palindromic substring</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/6.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>zig zag conversion</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/7.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>reverse integer</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/8.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>string to integer atoi</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/9.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>palindrome number</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/algorithm/proxy/10.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>container with most water</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-0dd73670 data-v-e5c4cdba><div class="VPDoc has-sidebar has-aside" data-v-e5c4cdba data-v-bd22cb21><div class="container" data-v-bd22cb21><div class="aside" data-v-bd22cb21><div class="aside-curtain" data-v-bd22cb21></div><div class="aside-container" data-v-bd22cb21><div class="aside-content" data-v-bd22cb21><div class="VPDocAside" data-v-bd22cb21 data-v-76ddb78d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-76ddb78d data-v-71bbc13b><div class="content" data-v-71bbc13b><div class="outline-marker" data-v-71bbc13b></div><div class="outline-title" data-v-71bbc13b>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-71bbc13b><span class="visually-hidden" id="doc-outline-aria-label" data-v-71bbc13b> Table of Contents for current page </span><ul class="root" data-v-71bbc13b data-v-c04a736d><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-76ddb78d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-bd22cb21><div class="content-container" data-v-bd22cb21><!--[--><!--]--><main class="main" data-v-bd22cb21><div style="position:relative;" class="vp-doc _algorithm_comp_1" data-v-bd22cb21><div><!----><h2 id="线段树-segment-tree-是一种二叉树形数据结构" tabindex="-1">线段树 Segment tree 是一种二叉树形数据结构 <a class="header-anchor" href="#线段树-segment-tree-是一种二叉树形数据结构" aria-hidden="true">#</a></h2><p>1977年由 Jon Louis Bentley 发明，用以存储区间或线段，并且允许快速查询结构内包含某一点的所有区间。</p><p>一个包含 (n ) 个区间的线段树，空间复杂度为 ( O(n) ) ，查询的时间复杂度则为 (O(log n+k) ) ，其中 ( k ) 是符合条件的区间数量。线段树的数据结构也可推广到高维度。</p><h2 id="一-什么是线段树" tabindex="-1">一. 什么是线段树 <a class="header-anchor" href="#一-什么是线段树" aria-hidden="true">#</a></h2><p>以一维的线段树为例。</p><img src="/algorithm/assets/comp1-1.cbf542ae.png"><p>令 S 是一维线段的集合。将这些线段的端点坐标由小到大排序，令其为 (x_{1},x_{2},\cdots ,x_{m} ) 。我们将被这些端点切分的每一个区间称为“单位区间”（每个端点所在的位置会单独成为一个单位区间），从左到右包含：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">\[ (</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">\infty </span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">[x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">(x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">[x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,...,</span><span style="color:#A6ACCD;">(x_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">m-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">[x_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">x_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">(x_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">},+</span><span style="color:#A6ACCD;">\infty )\]</span></span>
<span class="line"></span></code></pre></div><p>线段树的结构为一个二叉树，每个节点都代表一个坐标区间，节点 N 所代表的区间记为 Int(N)，则其需符合以下条件：</p><p>其每一个叶节点，从左到右代表每个单位区间。 其内部节点代表的区间是其两个儿子代表的区间之并集。 每个节点（包含叶子）中有一个存储线段的数据结构。若一个线段 S 的坐标区间包含 Int(N) 但不包含 Int(parent(N))，则节点 N 中会存储线段 S。</p><img src="/algorithm/assets/comp1-2.6178fe73.png"><p>线段树是二叉树，其中每个节点代表一个区间。通常，一个节点将存储一个或多个合并的区间的数据，以便可以执行查询操作。</p><h2 id="二-为什么需要这种数据结构" tabindex="-1">二. 为什么需要这种数据结构 <a class="header-anchor" href="#二-为什么需要这种数据结构" aria-hidden="true">#</a></h2><p>许多问题要求我们基于对可用数据范围或区间的查询来给出结果。这可能是一个繁琐而缓慢的过程，尤其是在查询数量众多且重复的情况下。线段树让我们以对数时间复杂度有效地处理此类查询。</p><p>线段树可用于计算几何和 地理信息系统领域。例如，距中心参考点/原点一定距离的空间中可能会有大量点。假设我们要查找距原点一定距离范围内的点。一个普通的查找表将需要对所有可能的点或所有可能的距离进行线性扫描（假设是散列图）。线段树使我们能够以对数时间实现这一需求，而所需空间却少得多。这样的问题称为 平面范围搜索。有效地解决此类问题至关重要，尤其是在处理动态数据且瞬息万变的情况下（例如，用于空中交通的雷达系统）。下文会以线段树解决 Range Sum Query problem 为例。</p><img src="/algorithm/assets/comp1-3.59dbc96e.png"><p>上图即作为范围查询的线段树。</p><h2 id="三-构造线段树" tabindex="-1">三. 构造线段树 <a class="header-anchor" href="#三-构造线段树" aria-hidden="true">#</a></h2><p>假设数据存在 size 为 n 的 arr[] 中。</p><p>线段树的根通常代表整个数据区间。这里是 arr[0：n-1]。 树的每个叶子代表一个范围，其中仅包含一个元素。 因此，叶子代表 arr[0]，arr[1] 等等，直到 arr[n-1]。 树的内部节点将代表其子节点的合并或并集结果。 每个子节点可代表其父节点所代表范围的大约一半。(二分的思想) 使用大小为 (\approx 4 \ast n ) 的数组可以轻松表示 n 个元素范围的线段树。（ Stack Overflow 对原因进行了很好的讨论。如果你还不确定，请不要担心。本文将在稍后进行讨论。）</p><p>下标为 i 的节点有两个节点，下标分别为 ((2 \ast i + 1) ) 和 ((2 \ast i + 2)) 。</p><img src="/algorithm/assets/comp1-4.8858ce44.png"><p>线段树看上去很直观并且非常适合递归构造。</p><p>我们将使用数组 tree[] 来存储线段树的节点（初始化为全零）。 下标从 0 开始。</p><p>树的节点在下标 0 处。因此 tree[0] 是树的根。</p><p>tree[i] 的孩子存在 tree[2 * i + 1] 和 tree[2 * i + 2] 中。</p><p>用额外的 0 或 null 值填充 arr[]，使得 (n = 2^{k} ) （其中 n 是 arr[] 的总长度，而 k 是非负整数。） 叶子节点的下标取值范围在 ( \in [2^{k}-1, 2^{k+1}-2])</p><img src="/algorithm/assets/comp1-5.6bf5e551.png"><p>构造线段树的代码如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// SegmentTree define</span></span>
<span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SegmentTree</span><span style="color:#A6ACCD;"> struct {</span></span>
<span class="line"><span style="color:#A6ACCD;">	data, tree, lazy []int</span></span>
<span class="line"><span style="color:#A6ACCD;">	left, right      int</span></span>
<span class="line"><span style="color:#A6ACCD;">	merge            func(i, j int) int</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Init define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">Init</span><span style="color:#A6ACCD;">(nums []int</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> oper </span><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;">(i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> j int) int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">merge</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oper</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tree</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">lazy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">make</span><span style="color:#F07178;">([]</span><span style="color:#A6ACCD;">int</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">make</span><span style="color:#F07178;">([]</span><span style="color:#A6ACCD;">int</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">make</span><span style="color:#F07178;">([]</span><span style="color:#A6ACCD;">int</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tree</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lazy</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 在 treeIndex 的位置创建 [left....right] 区间的线段树</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">leftChild</span><span style="color:#A6ACCD;">(index int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">rightChild</span><span style="color:#A6ACCD;">(index int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>笔者将线段树合并的操作变成了一个函数。合并操作根据题意变化，常见的有加法，取 max，min 等等。</p><p>我们以 arr[] = [18, 17, 13, 19, 15, 11, 20, 12, 33, 25 ] 为例构造线段树：</p><img src="/algorithm/assets/comp1-6.3b3b1d6b.png"><p>线段树构造好以后，数组里面的数据是：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">tree[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [ </span><span style="color:#F78C6C;">183</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">82</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">48</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">34</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">43</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">58</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">35</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">19</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">31</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">33</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">25</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> ]</span></span>
<span class="line"></span></code></pre></div><p>线段树用 0 填充到 4*n 个元素。</p><p>LeetCode 对应题目是 218. The Skyline Problem、 303. Range Sum Query - Immutable、 307. Range Sum Query - Mutable、 699. Falling Squares</p><h2 id="四-线段树的查询" tabindex="-1">四. 线段树的查询 <a class="header-anchor" href="#四-线段树的查询" aria-hidden="true">#</a></h2><p>线段树的查询方法有两种，一种是直接查询，另外一种是懒查询。</p><h2 id="_1-直接查询" tabindex="-1">1. 直接查询 <a class="header-anchor" href="#_1-直接查询" aria-hidden="true">#</a></h2><p>当查询范围与当前节点表示的范围完全匹配时，该方法返回结果。否则，它会更深入地遍历线段树树，以找到与节点的一部分完全匹配的节点。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">// 查询 [left....right] 区间内的值</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// Query define</span></span>
<span class="line"><span style="color:#A6ACCD;">func (st *SegmentTree) Query(left, right int) int {</span></span>
<span class="line"><span style="color:#A6ACCD;">	if len(st.data) &gt; 0 {</span></span>
<span class="line"><span style="color:#A6ACCD;">		return st.queryInTree(0, 0, len(st.data)-1, left, right)</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">	return 0</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// 在以 treeIndex 为根的线段树中 [left...right] 的范围里，搜索区间 [queryLeft...queryRight] 的值</span></span>
<span class="line"><span style="color:#A6ACCD;">func (st *SegmentTree) queryInTree(treeIndex, left, right, queryLeft, queryRight int) int {</span></span>
<span class="line"><span style="color:#A6ACCD;">	if left == queryLeft &amp;&amp; right == queryRight {</span></span>
<span class="line"><span style="color:#A6ACCD;">		return st.tree[treeIndex]</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">	midTreeIndex, leftTreeIndex, rightTreeIndex := left+(right-left)&gt;&gt;1, st.leftChild(treeIndex), st.rightChild(treeIndex)</span></span>
<span class="line"><span style="color:#A6ACCD;">	if queryLeft &gt; midTreeIndex {</span></span>
<span class="line"><span style="color:#A6ACCD;">		return st.queryInTree(rightTreeIndex, midTreeIndex+1, right, queryLeft, queryRight)</span></span>
<span class="line"><span style="color:#A6ACCD;">	} else if queryRight &lt;= midTreeIndex {</span></span>
<span class="line"><span style="color:#A6ACCD;">		return st.queryInTree(leftTreeIndex, left, midTreeIndex, queryLeft, queryRight)</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">	return st.merge(st.queryInTree(leftTreeIndex, left, midTreeIndex, queryLeft, midTreeIndex),</span></span>
<span class="line"><span style="color:#A6ACCD;">		st.queryInTree(rightTreeIndex, midTreeIndex+1, right, midTreeIndex+1, queryRight))</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><img src="/algorithm/assets/comp1-7.6ed32ecb.png"><p>在上面的示例中，查询的区间范围为[2，8] 的元素之和。没有任何线段可以完全代表[2，8] 范围。但是可以观察到，可以使用范围 [2，2]，[3，4]，[5，7]，[8，8] 这 4 个区间构成 [8，8]。快速验证 [2,8] 处的输入元素之和为 13 + 19 + 15 + 11 + 20 + 12 + 33 = 123。[2，2]，[3，4]，[5，7] 和 [8，8] 的节点总和是 13 + 34 + 43 + 33 = 123。答案正确。</p><h2 id="_2-懒查询" tabindex="-1">2. 懒查询 <a class="header-anchor" href="#_2-懒查询" aria-hidden="true">#</a></h2><p>懒查询对应懒更新，两者是配套操作。在区间更新时，并不直接更新区间内所有节点，而是把区间内节点增减变化的值存在 lazy 数组中。等到下次查询的时候再把增减应用到具体的节点上。这样做也是为了分摊时间复杂度，保证查询和更新的时间复杂度在 O(log n) 级别，不会退化成 O(n) 级别。</p><p>懒查询节点的步骤：</p><ul><li>先判断当前节点是否是懒节点。通过查询 lazy[i] 是否为 0 判断。如果是懒节点，将它的增减变化应用到该节点上。并且更新它的孩子节点。这一步和更新操作的第一步完全一样。</li><li>递归查询子节点，以找到适合的查询节点。</li></ul><p>具体代码如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// 查询 [left....right] 区间内的值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// QueryLazy define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">QueryLazy</span><span style="color:#A6ACCD;">(left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> queryRight int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// segment completely outside range</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// represents a null node</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// this node is lazy</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.tree[treeIndex] += (right - left + 1) * st.lazy[treeIndex] // normalize current node by removing lazinesss</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// update lazy[] for children nodes</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[leftTreeIndex] += st.lazy[treeIndex]</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[rightTreeIndex] += st.lazy[treeIndex]</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// current node processed. No longer lazy</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// segment completely inside range</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// merge query results</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="五-线段树的更新" tabindex="-1">五. 线段树的更新 <a class="header-anchor" href="#五-线段树的更新" aria-hidden="true">#</a></h2><h2 id="_1-单点更新" tabindex="-1">1. 单点更新 <a class="header-anchor" href="#_1-单点更新" aria-hidden="true">#</a></h2><p>单点更新类似于 buildSegTree。更新树的叶子节点的值，该值与更新后的元素相对应。这些更新的值会通过树的上层节点把影响传播到根。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// 更新 index 位置的值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Update define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">Update</span><span style="color:#A6ACCD;">(index</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateInTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 以 treeIndex 为根，更新 index 位置上的值为 val</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">updateInTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> index</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><img src="/algorithm/assets/comp1-8.ff159224.png"><p>在此示例中，下标为（在原始输入数据中）1、3 和 6 处的元素分别增加了 +3，-1 和 +2。可以看到更改如何沿树传播，一直到根。</p><h2 id="_2-区间更新" tabindex="-1">2. 区间更新 <a class="header-anchor" href="#_2-区间更新" aria-hidden="true">#</a></h2><p>线段树仅更新单个元素，非常有效，时间复杂度 O(log n)。 但是，如果我们要更新一系列元素怎么办？按照当前的方法，每个元素都必须独立更新，每个元素都会花费一些时间。分别更新每一个叶子节点意味着要多次处理它们的共同祖先。祖先节点可能被更新多次。如果想要减少这种重复计算，该怎么办？</p><img src="/algorithm/assets/comp1-8.ff159224.png"><p>在上面的示例中，根节点被更新了三次，而编号为 82 的节点被更新了两次。这是因为更新叶子节点对上层父亲节点有影响。最差的情况，查询的区间内不包含频繁更新的元素，于是需要花费很多时间更新不怎么访问的节点。增加额外的 lazy 数组，可以减少不必要的计算，并且能按需处理节点。</p><p>使用另一个数组 lazy[]，它的大小与我们的线段树 array tree[] 完全相同，代表一个惰性节点。当访问或查询该节点时，lazy[i] 中保留需要增加或者减少该节点 tree[i] 的数量。 当 lazy[i] 为 0 时，表示 tree[i] 该节点不是惰性的，并且没有缓存的更新。</p><p>更新区间内节点的步骤：</p><ul><li>先判断当前节点是否是懒节点。通过查询 lazy[i] 是否为 0 判断。如果是懒节点，将它的增减变化应用到该节点上。并且更新它的孩子节点。</li><li>如果当前节点代表的区间位于更新范围内，则将当前更新操作应用于当前节点。</li><li>递归更新子节点。</li></ul><p>具体代码如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// 更新 [updateLeft....updateRight] 位置的值</span></span>
<span class="line"><span style="color:#676E95;">// 注意这里的更新值是在原来值的基础上增加或者减少，而不是把这个区间内的值都赋值为 x，区间更新和单点更新不同</span></span>
<span class="line"><span style="color:#676E95;">// 这里的区间更新关注的是变化，单点更新关注的是定值</span></span>
<span class="line"><span style="color:#676E95;">// 当然区间更新也可以都更新成定值，如果只区间更新成定值，那么 lazy 更新策略需要变化，merge 策略也需要变化，这里暂不详细讨论</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// UpdateLazy define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">UpdateLazy</span><span style="color:#A6ACCD;">(updateLeft</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updateRight</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateRight</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentTree) </span><span style="color:#82AAFF;">updateLazyInTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updateLeft</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updateRight</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// this node is lazy</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//st.tree[treeIndex] += (right - left + 1) * st.lazy[treeIndex] // normalize current node by removing laziness</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// update lazy[] for children nodes</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[leftTreeIndex] += st.lazy[treeIndex]</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[rightTreeIndex] += st.lazy[treeIndex]</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// current node processed. No longer lazy</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// out of range. escape.</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// segment is fully within update range</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//st.tree[treeIndex] += (right - left + 1) * val // update segment</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// update lazy[] for children</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[leftTreeIndex] += val</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// st.lazy[rightTreeIndex] += val</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateRight</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateLazyInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateRight</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// merge updates</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>LeetCode 对应题目是 218. The Skyline Problem、 699. Falling Squares</p><h2 id="六-时间复杂度分析" tabindex="-1">六. 时间复杂度分析 <a class="header-anchor" href="#六-时间复杂度分析" aria-hidden="true">#</a></h2><p>让我们看一下构建过程。我们访问了线段树的每个叶子（对应于数组 arr[] 中的每个元素）。因此，我们处理大约 2 * n 个节点。这使构建过程时间复杂度为 O(n)。对于每个递归更新的过程都将丢弃区间范围的一半，以到达树中的叶子节点。这类似于二分搜索，只需要对数时间。更新叶子后，将更新树的每个级别上的直接祖先。这花费时间与树的高度成线性关系。</p><img src="/algorithm/assets/comp1-10.a50c7675.png"><p>4<em>n 个节点可以确保将线段树构建为完整的二叉树，从而树的高度为 log(4</em>n + 1) 向上取整。线段树读取和更新的时间复杂度都为 O(log n)。</p><h2 id="七-常见题型" tabindex="-1">七. 常见题型 <a class="header-anchor" href="#七-常见题型" aria-hidden="true">#</a></h2><h2 id="_1-range-sum-queries" tabindex="-1">1. Range Sum Queries <a class="header-anchor" href="#_1-range-sum-queries" aria-hidden="true">#</a></h2><p>Range Sum Queries 是 Range Queries 问题的子集。给定一个数据元素数组或序列，需要处理由元素范围组成的读取和更新查询。线段树 Segment Tree 和树状数组 Binary Indexed Tree (a.k.a. Fenwick Tree)) 都能很快的解决这类问题。</p><p>Range Sum Query 问题专门处理查询范围内的元素总和。这个问题存在许多变体，包括 不可变数据， 可变数据， 多次更新，单次查询 和 多次更新，多次查询。</p><h2 id="_2-单点更新" tabindex="-1">2. 单点更新 <a class="header-anchor" href="#_2-单点更新" aria-hidden="true">#</a></h2><p>HDU 1166 敌兵布阵 update:单点增减 query:区间求和 HDU 1754 I Hate It update:单点替换 query:区间最值 HDU 1394 Minimum Inversion Number update:单点增减 query:区间求和 HDU 2795 Billboard query:区间求最大值的位子(直接把update的操作在query里做了)</p><h2 id="_3-区间更新" tabindex="-1">3. 区间更新 <a class="header-anchor" href="#_3-区间更新" aria-hidden="true">#</a></h2><p>HDU 1698 Just a Hook update:成段替换 (由于只query一次总区间,所以可以直接输出 1 结点的信息) POJ 3468 A Simple Problem with Integers update:成段增减 query:区间求和 POJ 2528 Mayor’s posters 离散化 + update:成段替换 query:简单hash POJ 3225 Help with Intervals update:成段替换,区间异或 query:简单hash</p><h2 id="_4-区间合并" tabindex="-1">4. 区间合并 <a class="header-anchor" href="#_4-区间合并" aria-hidden="true">#</a></h2><p>这类题目会询问区间中满足条件的连续最长区间,所以PushUp的时候需要对左右儿子的区间进行合并</p><p>POJ 3667 Hotel update:区间替换 query:询问满足条件的最左端点</p><h2 id="_5-扫描线" tabindex="-1">5. 扫描线 <a class="header-anchor" href="#_5-扫描线" aria-hidden="true">#</a></h2><p>这类题目需要将一些操作排序,然后从左到右用一根扫描线扫过去最典型的就是矩形面积并,周长并等题</p><p>HDU 1542 Atlantis update:区间增减 query:直接取根节点的值 HDU 1828 Picture update:区间增减 query:直接取根节点的值</p><h2 id="_6-计数问题" tabindex="-1">6. 计数问题 <a class="header-anchor" href="#_6-计数问题" aria-hidden="true">#</a></h2><p>在 LeetCode 中还有一类问题涉及到计数的。 315. Count of Smaller Numbers After Self， 327. Count of Range Sum， 493. Reverse Pairs 这类问题可以用下面的套路解决。线段树的每个节点存的是区间计数。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// SegmentCountTree define</span></span>
<span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SegmentCountTree</span><span style="color:#A6ACCD;"> struct {</span></span>
<span class="line"><span style="color:#A6ACCD;">	data, tree  []int</span></span>
<span class="line"><span style="color:#A6ACCD;">	left, right int</span></span>
<span class="line"><span style="color:#A6ACCD;">	merge       func(i, j int) int</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Init define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">Init</span><span style="color:#A6ACCD;">(nums []int</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> oper </span><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;">(i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> j int) int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">merge</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oper</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">tree</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">make</span><span style="color:#F07178;">([]</span><span style="color:#A6ACCD;">int</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">make</span><span style="color:#F07178;">([]</span><span style="color:#A6ACCD;">int</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nums</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tree</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 在 treeIndex 的位置创建 [left....right] 区间的线段树</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">buildSegmentTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">merge</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">leftChild</span><span style="color:#A6ACCD;">(index int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">rightChild</span><span style="color:#A6ACCD;">(index int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 查询 [left....right] 区间内的值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Query define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">Query</span><span style="color:#A6ACCD;">(left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryInTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 在以 treeIndex 为根的线段树中 [left...right] 的范围里，搜索区间 [queryLeft...queryRight] 的值，值是计数值</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">queryInTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> queryRight int) int </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryLeft</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRight</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 更新计数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// UpdateCount define</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">UpdateCount</span><span style="color:#A6ACCD;">(val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateCountInTree</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">len</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// 以 treeIndex 为根，更新 [left...right] 区间内的计数</span></span>
<span class="line"><span style="color:#82AAFF;">func</span><span style="color:#A6ACCD;"> (st </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">SegmentCountTree) </span><span style="color:#82AAFF;">updateCountInTree</span><span style="color:#A6ACCD;">(treeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> left</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> right</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> val int) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tree</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">++</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">return</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">rightTreeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">left</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">leftChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rightChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">treeIndex</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateCountInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rightTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">right</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">st</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateCountInTree</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">leftTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">left</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">midTreeIndex</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-bd22cb21 data-v-66ddf6b8><!----><div class="prev-next" data-v-66ddf6b8><div class="pager" data-v-66ddf6b8><a class="pager-link prev" href="/algorithm/data/19.html" data-v-66ddf6b8><span class="desc" data-v-66ddf6b8>Previous page</span><span class="title" data-v-66ddf6b8>binary indexed tree</span></a></div><div class="has-prev pager" data-v-66ddf6b8><a class="pager-link next" href="/algorithm/comp/2.html" data-v-66ddf6b8><span class="desc" data-v-66ddf6b8>Next page</span><span class="title" data-v-66ddf6b8>unionfind</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"d47eebb4\",\"comp_1.md\":\"87a73c59\",\"comp_2.md\":\"63d4bd8d\",\"comp_3.md\":\"fb208e41\",\"comp_4.md\":\"67a7ddc1\",\"comp_5.md\":\"e37c6b01\",\"data_1.md\":\"60ed8a72\",\"data_10.md\":\"78695367\",\"data_11.md\":\"be062256\",\"data_12.md\":\"a8009fbf\",\"data_13.md\":\"f66e8813\",\"data_14.md\":\"af9e5c74\",\"data_15.md\":\"dcaf3211\",\"data_16.md\":\"4f83e202\",\"data_17.md\":\"949be3af\",\"data_18.md\":\"9d770fbb\",\"data_19.md\":\"f6dd0691\",\"data_2.md\":\"d4c33e81\",\"data_3.md\":\"c300bbc0\",\"data_4.md\":\"e9d8cc91\",\"data_5.md\":\"0cc87223\",\"data_6.md\":\"c1de20a4\",\"data_7.md\":\"c850b475\",\"data_8.md\":\"14ed2467\",\"data_9.md\":\"f9be4db2\",\"index.md\":\"29f053b1\",\"intro_1.md\":\"de2ab6c6\",\"intro_2.md\":\"023e348d\",\"intro_3.md\":\"1f34a516\",\"proxy_1.md\":\"7a3966f5\",\"proxy_10.md\":\"31fdb7bc\",\"proxy_2.md\":\"b6b35ac3\",\"proxy_3.md\":\"51a776eb\",\"proxy_4.md\":\"aa626d09\",\"proxy_5.md\":\"933cfcd3\",\"proxy_6.md\":\"9feeb5e1\",\"proxy_7.md\":\"8a9f153f\",\"proxy_8.md\":\"cb90440c\",\"proxy_9.md\":\"329141cd\"}")</script>
    <script type="module" async src="/algorithm/assets/app.b5287e93.js"></script>
    
  </body>
</html>